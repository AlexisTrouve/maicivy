# Penetration Testing Guide

**Project:** maicivy
**Version:** 1.0
**Last Updated:** 2025-12-08

---

## üìã Overview

This guide provides instructions for conducting security penetration testing on the maicivy application. It covers tools, methodologies, test scenarios, and reporting procedures.

**Important:** Only test systems you have permission to test. Always conduct testing in a controlled environment (staging/development) first.

---

## üéØ Testing Scope

### In Scope
- ‚úÖ Web application (frontend + backend)
- ‚úÖ API endpoints
- ‚úÖ Authentication mechanisms (when implemented)
- ‚úÖ Input validation
- ‚úÖ Rate limiting
- ‚úÖ Session management
- ‚úÖ Database interactions
- ‚úÖ External integrations (AI APIs, scraper)

### Out of Scope
- ‚ùå Social engineering
- ‚ùå Physical security
- ‚ùå Denial of Service (DoS) attacks
- ‚ùå Third-party services (Claude, OpenAI APIs)
- ‚ùå Production environment (without explicit permission)

---

## üõ†Ô∏è Testing Tools

### Essential Tools

#### 1. OWASP ZAP (Zed Attack Proxy)
**Purpose:** Automated vulnerability scanner and manual testing proxy

**Installation:**
```bash
# Docker (recommended)
docker pull zaproxy/zap-stable
docker run -u zap -p 8080:8080 -i zaproxy/zap-stable zap-webswing.sh

# Or download from https://www.zaproxy.org/download/
```

**Usage:**
```bash
# Automated scan
zap-cli quick-scan --self-contained --start-options '-config api.disablekey=true' \
  http://localhost:3000

# With authentication (future)
zap-cli quick-scan --auth-user admin --auth-pass password123 \
  http://localhost:3000
```

#### 2. Burp Suite Community Edition
**Purpose:** Web application security testing platform

**Download:** https://portswigger.net/burp/communitydownload

**Key Features:**
- Intercept and modify HTTP/HTTPS requests
- Spider/crawl application
- Repeater for manual testing
- Scanner (limited in free version)

#### 3. sqlmap
**Purpose:** SQL injection detection and exploitation

**Installation:**
```bash
# Linux/Mac
git clone --depth 1 https://github.com/sqlmapproject/sqlmap.git sqlmap-dev

# Use
python sqlmap.py -u "http://localhost:8080/api/cv?theme=backend" --batch
```

#### 4. curl / wget
**Purpose:** Manual HTTP request testing

**Examples:**
```bash
# Test API endpoints
curl -X GET http://localhost:8080/api/cv?theme=backend

# Test with headers
curl -H "Origin: http://evil.com" http://localhost:8080/api/cv

# Test POST with payload
curl -X POST http://localhost:8080/api/letters/generate \
  -H "Content-Type: application/json" \
  -d '{"company_name":"<script>alert(1)</script>"}'
```

#### 5. Postman / Insomnia
**Purpose:** API testing and exploration

**Download:**
- Postman: https://www.postman.com/downloads/
- Insomnia: https://insomnia.rest/download

### Optional Advanced Tools

- **Nikto**: Web server scanner
- **Nmap**: Port scanner
- **WPScan**: WordPress security scanner (if using WordPress)
- **Metasploit**: Exploitation framework
- **ffuf**: Web fuzzer

---

## üß™ Test Scenarios

### 1. SQL Injection Testing

#### Target Endpoints
- `GET /api/cv?theme=<PAYLOAD>`
- `GET /api/analytics?filter=<PAYLOAD>`
- `POST /api/letters/generate` (company_name field)

#### Test Cases

**1.1 Basic SQL Injection**
```bash
# Test for error-based injection
curl "http://localhost:8080/api/cv?theme=' OR '1'='1"
curl "http://localhost:8080/api/cv?theme=backend'; DROP TABLE users--"

# Expected: Should return validation error (400), not SQL error (500)
```

**1.2 Boolean-based Blind SQL Injection**
```bash
# Test for boolean injection
curl "http://localhost:8080/api/cv?theme=backend' AND '1'='1"
curl "http://localhost:8080/api/cv?theme=backend' AND '1'='2"

# Expected: Both should return same validation error
```

**1.3 Time-based Blind SQL Injection**
```bash
# Test for time-based injection (PostgreSQL)
curl "http://localhost:8080/api/cv?theme=backend'; SELECT pg_sleep(10)--"

# Expected: Should NOT delay response
```

**1.4 Automated sqlmap**
```bash
# Run sqlmap on all API endpoints
sqlmap -u "http://localhost:8080/api/cv?theme=backend" \
  --batch --level=3 --risk=2

# Expected: No vulnerabilities found
```

### 2. Cross-Site Scripting (XSS) Testing

#### Target Inputs
- Company name field (letter generation)
- Search queries (if implemented)
- Any user-generated content

#### Test Cases

**2.1 Reflected XSS**
```bash
# Test basic XSS
curl -X POST http://localhost:8080/api/letters/generate \
  -H "Content-Type: application/json" \
  -d '{"company_name":"<script>alert(\"XSS\")</script>"}'

# Expected: Should sanitize and reject
```

**2.2 Stored XSS**
```bash
# Test stored XSS (if data persists)
curl -X POST http://localhost:8080/api/analytics/event \
  -H "Content-Type: application/json" \
  -d '{"eventType":"click","eventData":{"note":"<img src=x onerror=alert(1)>"}}'

# Expected: Should sanitize before storage
```

**2.3 DOM-based XSS**
```javascript
// Test in browser console
// Try to execute script via URL parameters
http://localhost:3000/cv?theme=<script>alert(1)</script>

// Expected: Should be escaped by Next.js
```

**2.4 XSS Payloads List**
```html
<script>alert(1)</script>
<img src=x onerror=alert(1)>
<svg onload=alert(1)>
<iframe src="javascript:alert(1)">
<body onload=alert(1)>
<input onfocus=alert(1) autofocus>
<select onfocus=alert(1) autofocus>
<textarea onfocus=alert(1) autofocus>
<keygen onfocus=alert(1) autofocus>
<video><source onerror="alert(1)">
<audio src=x onerror=alert(1)>
<details open ontoggle=alert(1)>
<marquee onstart=alert(1)>
```

### 3. Authentication & Authorization Testing

#### Test Cases (when admin panel is implemented)

**3.1 Weak Password Testing**
```bash
# Test common passwords
passwords=("password" "123456" "admin" "letmein" "password123")

for pwd in "${passwords[@]}"; do
  curl -X POST http://localhost:8080/api/auth/login \
    -H "Content-Type: application/json" \
    -d "{\"email\":\"admin@example.com\",\"password\":\"$pwd\"}"
done

# Expected: Should reject weak passwords
```

**3.2 Brute Force Protection**
```bash
# Test rate limiting on login
for i in {1..100}; do
  curl -X POST http://localhost:8080/api/auth/login \
    -H "Content-Type: application/json" \
    -d '{"email":"admin@example.com","password":"wrong"}'
  echo "Attempt $i"
done

# Expected: Should block after N attempts
```

**3.3 Session Fixation**
```bash
# Get a session ID
SESSION=$(curl -c - http://localhost:8080 | grep session_id | awk '{print $7}')

# Try to use it for authentication
curl -b "session_id=$SESSION" http://localhost:8080/api/admin/users

# Expected: Should require proper authentication
```

### 4. Server-Side Request Forgery (SSRF)

#### Target: Company Info Scraper

**4.1 Internal Network Access**
```bash
# Test access to localhost
curl -X POST http://localhost:8080/api/letters/generate \
  -H "Content-Type: application/json" \
  -d '{"company_name":"http://127.0.0.1:5432"}'

# Expected: Should block (validation error)
```

**4.2 Cloud Metadata Access (AWS, GCP, Azure)**
```bash
# AWS metadata endpoint
curl -X POST http://localhost:8080/api/letters/generate \
  -H "Content-Type: application/json" \
  -d '{"company_name":"http://169.254.169.254/latest/meta-data/"}'

# Expected: Should block private IPs
```

**4.3 File:// Protocol**
```bash
# Test file protocol
curl -X POST http://localhost:8080/api/letters/generate \
  -H "Content-Type: application/json" \
  -d '{"company_name":"file:///etc/passwd"}'

# Expected: Should block (only http/https allowed)
```

### 5. Rate Limiting Testing

**5.1 Global Rate Limit**
```bash
# Flood requests
for i in {1..200}; do
  curl -s http://localhost:8080/api/cv?theme=backend > /dev/null
  echo "Request $i"
done

# Expected: Should receive 429 after ~100 requests/minute
```

**5.2 AI Endpoint Rate Limit**
```bash
# Test AI generation limit (5/day)
for i in {1..10}; do
  curl -X POST http://localhost:8080/api/letters/generate \
    -H "Content-Type: application/json" \
    -b "session_id=test_session_123" \
    -d '{"company_name":"TestCorp"}'
  echo "Generation $i"
  sleep 1
done

# Expected: Should block after 5 generations
```

**5.3 Bypass Attempts**
```bash
# Try to bypass with different IPs
curl -H "X-Forwarded-For: 1.2.3.4" http://localhost:8080/api/cv

# Try to bypass with different sessions
curl -b "session_id=session1" http://localhost:8080/api/cv
curl -b "session_id=session2" http://localhost:8080/api/cv

# Expected: Should not bypass rate limits
```

### 6. CORS Testing

**6.1 Origin Validation**
```bash
# Test with unauthorized origin
curl -H "Origin: http://evil.com" http://localhost:8080/api/cv

# Expected: Should reject or not send CORS headers
```

**6.2 Credentials with Wildcard**
```bash
# Check if wildcard is used with credentials
curl -v -H "Origin: http://evil.com" http://localhost:8080/api/cv \
  | grep "Access-Control-Allow-Credentials"

# Expected: Should NOT be "true" with wildcard origins
```

### 7. Security Headers Testing

**7.1 Check Headers**
```bash
# Test security headers presence
curl -I https://maicivy.example.com

# Expected headers:
# - Strict-Transport-Security
# - X-Frame-Options: DENY
# - X-Content-Type-Options: nosniff
# - Content-Security-Policy
# - Referrer-Policy
```

**7.2 Clickjacking Test**
```html
<!-- Create test HTML file -->
<iframe src="https://maicivy.example.com"></iframe>

<!-- Expected: Should be blocked by X-Frame-Options -->
```

### 8. Input Validation Testing

**8.1 Null Byte Injection**
```bash
# Test null byte in input
curl -X POST http://localhost:8080/api/letters/generate \
  -H "Content-Type: application/json" \
  -d $'{"company_name":"Test\x00Company"}'

# Expected: Should sanitize null bytes
```

**8.2 Oversized Payloads**
```bash
# Test with large payload (> 10MB)
dd if=/dev/zero bs=1M count=20 | \
curl -X POST http://localhost:8080/api/letters/generate \
  -H "Content-Type: application/json" \
  -d @-

# Expected: Should reject (413 Payload Too Large)
```

**8.3 Special Characters**
```bash
# Test various special characters
curl -X POST http://localhost:8080/api/letters/generate \
  -H "Content-Type: application/json" \
  -d '{"company_name":"Test & <Company> \"Inc.\" '\''Ltd'\''"}'

# Expected: Should handle safely
```

---

## üìä Testing Methodology

### 1. Reconnaissance Phase
- Map all application endpoints
- Identify input fields
- Discover hidden endpoints (fuzzing)
- Review JavaScript files for API endpoints
- Check robots.txt, sitemap.xml

### 2. Vulnerability Assessment
- Run automated scans (OWASP ZAP, Nikto)
- Manual testing with Burp Suite
- SQL injection testing (sqlmap)
- XSS testing (various payloads)
- SSRF testing

### 3. Exploitation Phase (Optional)
- Attempt to exploit confirmed vulnerabilities
- Document exploit steps
- Assess impact and severity

### 4. Reporting Phase
- Document all findings
- Assign severity (Critical, High, Medium, Low, Info)
- Provide remediation recommendations
- Create proof-of-concept (PoC)

---

## üìù Reporting Format

### Vulnerability Report Template

```markdown
# Vulnerability Report: [TITLE]

## Summary
Brief description of the vulnerability.

## Severity
- **CVSS Score:** X.X
- **Severity:** Critical / High / Medium / Low / Informational

## Affected Components
- Endpoint: /api/example
- Parameter: user_input
- Method: POST

## Description
Detailed description of the vulnerability.

## Proof of Concept
```bash
# Steps to reproduce
curl -X POST http://localhost:8080/api/example \
  -d "user_input=<payload>"
```

## Impact
What an attacker can achieve by exploiting this vulnerability.

## Remediation
Recommended fixes:
1. Implement input validation
2. Use parameterized queries
3. Add rate limiting

## References
- OWASP: https://owasp.org/www-community/vulnerabilities/...
- CWE-79: https://cwe.mitre.org/data/definitions/79.html
```

### Severity Levels

| Severity | Description | CVSS Score |
|----------|-------------|------------|
| Critical | Remote code execution, authentication bypass | 9.0-10.0 |
| High | SQL injection, privilege escalation | 7.0-8.9 |
| Medium | XSS, CSRF, sensitive data exposure | 4.0-6.9 |
| Low | Information disclosure, weak configuration | 0.1-3.9 |
| Informational | Best practice recommendations | 0.0 |

---

## üîí Safe Testing Practices

### Do's
‚úÖ Test in staging/development environment first
‚úÖ Get written permission before testing production
‚úÖ Use rate limiting to avoid DoS
‚úÖ Document all findings
‚úÖ Report vulnerabilities responsibly
‚úÖ Backup data before destructive tests

### Don'ts
‚ùå Test production without permission
‚ùå Perform DoS attacks
‚ùå Modify or delete data without permission
‚ùå Share vulnerabilities publicly before disclosure
‚ùå Use findings for malicious purposes
‚ùå Test third-party services (Claude, OpenAI)

---

## üìÖ Testing Schedule

### Initial Penetration Test
- Before production launch
- Full scope testing (1-2 weeks)
- External security firm recommended

### Regular Testing
- **Monthly:** Automated scans (OWASP ZAP, npm audit, gosec)
- **Quarterly:** Manual penetration test (internal)
- **Annually:** Full external penetration test

### Post-Deployment Testing
- After major features
- After security updates
- After third-party library updates

---

## üõ°Ô∏è Post-Testing Actions

### 1. Vulnerability Prioritization
- Rank by severity and exploitability
- Consider business impact
- Create remediation timeline

### 2. Remediation
- Fix critical/high vulnerabilities immediately
- Schedule medium/low vulnerabilities
- Re-test after fixes

### 3. Continuous Monitoring
- Enable security logging
- Monitor for attack patterns
- Set up alerts for suspicious activity

---

## üìö Resources

### Tools Documentation
- [OWASP ZAP User Guide](https://www.zaproxy.org/docs/)
- [Burp Suite Documentation](https://portswigger.net/burp/documentation)
- [sqlmap Wiki](https://github.com/sqlmapproject/sqlmap/wiki)

### Testing Resources
- [OWASP Testing Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [PortSwigger Web Security Academy](https://portswigger.net/web-security)
- [HackerOne Hacktivity](https://hackerone.com/hacktivity)

### Bug Bounty Platforms
- [HackerOne](https://www.hackerone.com/)
- [Bugcrowd](https://www.bugcrowd.com/)
- [Intigriti](https://www.intigriti.com/)

---

**Prepared by:** Security Team
**Approved by:** CTO
**Next Review:** 2026-03-08
